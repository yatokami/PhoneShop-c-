@using ViewModels
@model UserListView
@{
    Layout = "~/Views/Shared/User_Layout.cshtml";
}


@section ContentClass{

}

@section ContentBody{
    <div class="form-group">
        <input id="GoodsID" type="hidden" value="@Model.Goods.GoodsID" />
        <p> 商品名称:@Model.Goods.GoodsName</p>
        <img style="width:300px;height:300px" class="img-rounded" src="@Model.Goods.GoodsPicture" />
        <div class="li-price">
            <p>@Model.Goods.Price</p>
            <input id="price" type="hidden" value="@Model.Goods.Price">
        </div>
        <div class="li-quantity">
            <a data-type="add" href="javascript:void(0);" class="btn btn-default btn-xs ">+</a>
            <input id="num" style="width: 40px;" type="text" value="1">
            <a data-type='subtr' href="javascript:void(0);" class="btn btn-default btn-xs">-</a>
        </div>
        <div style="float: right;height: 35px;width:330px;">
            总计：<p id="money" style="color: red;font-size: 25px"></p>
        </div>
        <input id="Well" type="button" value="@Model.WellBad.Well" onclick="WellBad(1)"/>
        <input id="Bad" type="button" value="@Model.WellBad.Bad" onclick="WellBad(-1)" />
        <input type="button" class="btn btn-success"value="加入购物车" onclick="AddCart()">
    </div>
    <ul class="list-group">
    @foreach (var Data in Model.CommentViews.GetPagingData())
    {
        <li class="list-group-item list-group-item-success">
            <div class="media">
                <div class="media-left media-middle">
                    <a href="#">
                        <p id="p1">@Data.Uname</p>
                    </a>
                </div>
                <div class="media-body">
                    <h4 class="media-heading">@Data.CommentStartTime</h4>
                    <p id="p2">@Data.CommentContent</p>
                </div>
            </div>
        </li>
    }
        <li style="list-style-type:none;">
            @if (Model.CommentViews.HasPrev)
            {
                @*<a href="@Url.Action("Show", "Home", new { GoodsID = Model.Goods.GoodsID, MopageIndex = Model.CommentViews.PageIndex - 1 })">上一页</a>*@
                <button class="btn btn-default" onclick="Paging(1)">上一页</button>
            }
            else
            {
                <button class="btn btn-default disabled">上一页</button>
            }
            @if (Model.CommentViews.HasNext)
            {
                @*<a href="@Url.Action("Show", "Home", new {GoodsID = Model.Goods.GoodsID, pageIndex = Model.CommentViews.PageIndex + 1 })">下一页</a>*@
               <button class="btn btn-default" onclick="Paging(-1)">下一页</button>
            }
            else
            {
                <button class="btn btn-default disabled">下一页</button>
            }
        </li>
</ul>
}


@section ContentScript{

<script>

    function Media(data)
    {
        $("ul li").each(function(k) {
            if (k < data.length) {
                $("#p1").text(data[k].Uname)
                $("h4").text(data[k].CommentStartTime)
                $("#p2").text(data[k].CommentContent)
            } else {
                return false
            }
        })
    }

    function Paging(index1)
    {
        if(index1 == 1) {
            var pageIndex = @Model.CommentViews.PageIndex - 1
        }
        else if(index1 == -1) {
            var pageIndex = @Model.CommentViews.PageIndex + 1
        }

        var GoodsID = @Model.Goods.GoodsID;
        var data = { "pageIndex": pageIndex, "GoodsID": GoodsID }
        $.ajax ({
            url: "/Home/Paging",
            type: "POST",
            data: data,
            success: function (data) {
                data = JSON.parse(data);
                console.log(data.length)
                Media(data)
            },
            error: function () {
               
            }
        })
        
    }

    function ChangeWB(index, result)
    {
        if(index == 1)
            $("#Well").val(result.Well)
        else if(index == -1)
            $("#Bad").val(result.Bad)
    }

    //异步提交点赞踩
    function WellBad(index)
    {
        var GoodsID = $("#GoodsID").val()
        var datas = { "GoodsID": GoodsID, "Index": index }
        $.ajax({
            url: "/User/WellBad",
            type: "POST",
            data: datas,
            success: function (data) {
                var result = $.parseJSON(data);

                if(index == 1 ) {
                    ChangeWB(1, result)
                } else if (index == -1) {
                    ChangeWB(-1, result)
                } else {
                    return alert("点击失败")
                }

            },
            error: function () {
                alert("点击失败")
            }
        })
    }



    $(function () {
        // 商品+-
        $('.li-quantity a').click(function () {
            var self = $(this);
            var type = self.attr('data-type'),
                num = parseFloat(self.siblings('input').val())
            if (type == 'add') {
                num += 1
            } else if (type == 'subtr') {
                if (num > 1) {
                    num -= 1
                } else {
                    return false
                }
            }
            self.siblings('input').val(num)
            tamount()
        });
    });
    var sum = 0
    //计算商品总价格
    function tamount() {
        price = $("#price").val()
        num = $("#num").val()
        sum = (parseFloat(price) * parseFloat(num))
        $("#money").html('￥' + sum + '.00')
    }
    tamount()

    //加入购物车
    function AddCart()
    {
        var Num = $("#num").val()
        var GoodsID = $("#GoodsID").val()
        var data = { "Num": Num, "GoodsID": GoodsID }
        $.ajax({
            url: "/User/AddCart",
            type: "POST",
            data: data,
            success: function (data) {
                alert(data)
            },
            error: function () {
                alert("加入购物车失败")
            }
        })

    }
 </script>
}